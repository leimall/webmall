(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{4010:function(e,t,s){Promise.resolve().then(s.bind(s,9346))},9346:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var a=s(7437),r=s(9910),n=s(2265),i=s(3537),l=s(7345),c=s(357);function d(){let e=(0,l.useStripe)(),t=(0,l.useElements)(),[s,r]=(0,n.useState)(null),[i,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!e)return;let t=new URLSearchParams(window.location.search).get("payment_intent_client_secret");t&&(null==e||e.retrievePaymentIntent(t).then(e=>{let{paymentIntent:t}=e;switch(null==t?void 0:t.status){case"succeeded":r("Payment succeeded!");break;case"processing":r("Your payment is processing.");break;case"requires_payment_method":r("Your payment was not successful, please try again.");break;default:r("Something went wrong.")}}))},[e]);let o=async s=>{if(s.preventDefault(),!e||!t)return;d(!0);let{error:a}=await e.confirmPayment({elements:t,confirmParams:{return_url:"".concat(c.env.DOMAIN_URL,"/order/success")}});"card_error"===a.type||"validation_error"===a.type?r(a.message||"An unexpected error occurred."):r("An unexpected error occurred."),d(!1)};return(0,a.jsxs)("form",{id:"payment-form",onSubmit:o,children:[(0,a.jsx)(l.PaymentElement,{id:"payment-element",options:{layout:"accordion"}}),(0,a.jsx)("button",{disabled:i||!e||!t,id:"submit",className:"mt-4 w-full text-white bg-fta-primary-500 hover:bg-fta-primary-600 focus:ring-4 focus:outline-none focus:ring-fta-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center",children:(0,a.jsx)("span",{id:"button-text",children:i?(0,a.jsx)("div",{className:"spinner",id:"spinner"}):"Pay now"})}),s&&(0,a.jsx)("div",{id:"payment-message",children:s})]})}var o=s(6648),u=s(8347),m=s(7138);function x(e){let{item:t,index:s,length:i}=e,{setQuantity:l,removeItem:c,setSkuValue:d}=(0,r.x)(),[x,p]=(0,n.useState)(["L","M","S","XS"]),[h,f]=(0,n.useState)([]),[j,y]=(0,n.useState)(0),[g,b]=(0,n.useState)(!0);(0,n.useEffect)(()=>{N()},[]);let N=()=>{f(x.map(e=>({value:e,label:e}))),t.price_off>0&&y(100-t.price_off),s===i-1&&b(!1),console.error("object",g,i,s)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"md:col-span-2 rounded-md",children:(0,a.jsx)("div",{className:"items-center gap-4",children:(0,a.jsxs)("div",{className:"md:col-span-2 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-32 h-32 shrink-0 border rounded",children:(0,a.jsx)(o.default,{src:t.main_img,alt:t.title,objectFit:"fixed",width:96,height:96,className:"rounded h-full w-full "})}),(0,a.jsxs)("div",{className:"w-full ml-0 md:ml-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-md font-bold text-gray-800 truncate",children:(0,a.jsx)(m.default,{href:"/product/".concat(t.product_id),children:(0,a.jsx)("div",{className:"text-sm text-pretty font-extrabold text-fta-primary-800 h-10 line-clamp-2",children:t.title})})}),(0,a.jsx)("h6",{onClick:()=>c(t.product_id),className:"text-sm text-blue-500 cursor-pointer mt-0.5",children:"Remove"})]}),(0,a.jsx)("div",{className:"flex items-center justify-end",children:(0,a.jsxs)("div",{className:"flex justify-center items-end font-sans",children:[t.old_price*t.quantity>0&&(0,a.jsxs)("span",{className:"text-gray-500 line-through text-sm mr-2",children:["$",t.old_price*t.quantity]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"text-gray-800 text-md font-bold",children:["$",t.price*t.quantity]}),(0,a.jsx)("div",{className:"text-red-600 text-sm font-bold px-2",children:t.price_off>0?"(-".concat(100-t.price_off,"%)"):""})]})]})}),(0,a.jsxs)("div",{className:"flex gap-4 mt-1 md:mt-2",children:[(0,a.jsx)("div",{className:"relative group bg-white",children:(0,a.jsx)("div",{children:(0,a.jsx)(u.default,{defaultValue:t.size,style:{width:80},options:h,onChange:e=>{d(t.product_id,e)}})})}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"bg-white",children:(0,a.jsxs)("div",{className:"flex items-center border border-gray-300 text-gray-800 text-md outline-none bg-transparent rounded",children:[(0,a.jsx)("div",{onClick:()=>{t.quantity>1&&l(t.product_id,t.quantity-1)},className:"px-3 py-3 cursor-pointer bg-orange-50  rounded-l ",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-2.5 fill-current",viewBox:"0 0 124 124",children:(0,a.jsx)("path",{d:"M112 50H12C5.4 50 0 55.4 0 62s5.4 12 12 12h100c6.6 0 12-5.4 12-12s-5.4-12-12-12z","data-original":"#000000"})})}),(0,a.jsx)("span",{className:"mx-2.5 w-5 text-center",children:t.quantity}),(0,a.jsx)("div",{onClick:()=>{l(t.product_id,t.quantity+1)},className:"px-3 cursor-pointer py-3 bg-orange-50 rounded-r",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-2.5 fill-current",viewBox:"0 0 42 42",children:(0,a.jsx)("path",{d:"M37.059 16H26V4.941C26 2.224 23.718 0 21 0s-5 2.224-5 4.941V16H4.941C2.224 16 0 18.282 0 21s2.224 5 4.941 5H16v11.059C16 39.776 18.282 42 21 42s5-2.224 5-4.941V26h11.059C39.776 26 42 23.718 42 21s-2.224-5-4.941-5z","data-original":"#000000"})})})]})})})]})]})]})})}),g&&(0,a.jsx)("hr",{className:"border-gray-black my-6"})]})}var p=s(4110);function h(){let{items:e,totalPrice:t,price:s}=(0,r.x)();return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex flex-col  md:flex-row ",children:[(0,a.jsx)("div",{className:"flex-1 bg-background-back0 border rounded-md p-2 md:p-4",children:(0,a.jsx)("div",{className:"p-0 md:p-4",children:e.map((t,s)=>(0,a.jsx)(x,{item:t,length:e.length,index:s},t.product_id))})}),(0,a.jsx)("div",{className:"w-full md:w-1/4 md:ml-8 sx:ml-0 ",children:(0,a.jsxs)("div",{className:"border rounded-md md:mt-0 mt-4 sm:ml-0 p-4 bg-background-back1",children:[(0,a.jsx)("div",{className:"px-4",children:(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Cart total"})}),(0,a.jsx)(p.Z,{}),(0,a.jsxs)("div",{className:"px-4 text-gray-800 space-y-2",children:[(0,a.jsxs)("p",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{className:"text-base",children:"Now Total"}),(0,a.jsxs)("span",{className:"ml-auto text-red-500 font-bold",children:["$",t]})]}),(0,a.jsxs)("p",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{className:"text-base",children:"Total"}),(0,a.jsxs)("span",{className:"ml-auto line-through",children:["$",s.toFixed(2)]})]}),(0,a.jsxs)("p",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{className:"text-base",children:"Save"}),(0,a.jsxs)("span",{className:"ml-auto",children:["$",(s-t).toFixed(2)]})]}),(0,a.jsxs)("p",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{className:"text-base",children:"Discount"}),(0,a.jsx)("span",{className:"ml-auto font-bold",children:"$0.00"})]}),(0,a.jsxs)("p",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{className:"text-base",children:"Tax"}),(0,a.jsx)("span",{className:"ml-auto font-bold",children:"$0.00"})]}),(0,a.jsxs)("p",{className:"flex justify-between py-1",children:[(0,a.jsx)("span",{className:"text-base",children:"Fee"}),(0,a.jsx)("span",{className:"ml-auto font-bold",children:"$0.00"})]})]}),(0,a.jsx)(p.Z,{}),(0,a.jsx)("div",{className:"px-4",children:(0,a.jsxs)("div",{className:"flex justify-between font-bold text-lg mt-4",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{className:"text-red-500",children:["$",t]})]})}),(0,a.jsxs)("div",{className:"mt-8 space-y-4",children:[(0,a.jsx)(m.default,{href:"/checkout",children:(0,a.jsx)("button",{className:"text-sm px-4 py-2.5 w-full font-semibold tracking-wide bg-fta-primary-500 hover:bg-fta-primary-600 text-white rounded-md",children:"Checkout"})}),(0,a.jsx)("div",{className:"w-4"}),(0,a.jsx)(m.default,{href:"/",children:(0,a.jsx)("button",{className:"text-sm px-4 py-2.5 w-full font-semibold tracking-wide bg-fta-background-100 hover:bg-fta-background-100 border text-fta-primary-500 rounded-md",children:"Continue Shopping"})})]})]})})]})})}var f=s(357);let j=(0,i.J)(f.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);function y(){let{items:e,addItem:t,removeItem:s,totalPrice:i}=(0,r.x)(),[c,o]=(0,n.useState)(null);return(0,a.jsxs)("div",{className:"relative mx-auto max-w-c-1280 py-5 justify-between align-items:flex-end px-2 md:px-8 2xl:px-0",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("ul",{className:"flex items-center font-[sans-serif] space-x-4 mb-4",children:[(0,a.jsx)(m.default,{href:"/",passHref:!0,children:(0,a.jsx)("li",{className:"text-gray-500 text-base cursor-pointer",children:"Home"})}),(0,a.jsx)("li",{children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"fill-gray-400 w-3.5 -rotate-90",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{"fill-rule":"evenodd",d:"M11.99997 18.1669a2.38 2.38 0 0 1-1.68266-.69733l-9.52-9.52a2.38 2.38 0 1 1 3.36532-3.36532l7.83734 7.83734 7.83734-7.83734a2.38 2.38 0 1 1 3.36532 3.36532l-9.52 9.52a2.38 2.38 0 0 1-1.68266.69734z","clip-rule":"evenodd","data-original":"#000000"})})}),(0,a.jsx)("li",{className:"text-gray-800 text-base font-bold cursor-pointer",children:"Shopping Cart"})]})}),(0,a.jsx)("h1",{className:"text-xl md:text-3xl py-1 md:py-4 mb-2",children:"Shopping Cart"}),0===e.length?(0,a.jsx)("div",{className:"w-full max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"bg-white sm:rounded-lg p-6 text-center",children:(0,a.jsx)("p",{className:"text-3xl lg:h-96",children:"Your cart is empty"})})}):(0,a.jsx)(h,{}),(0,a.jsx)("div",{className:"mb-8",children:c&&(0,a.jsx)(l.Elements,{stripe:j,options:{clientSecret:c},children:(0,a.jsx)(d,{})})})]})}},9910:function(e,t,s){"use strict";s.d(t,{x:function(){return u}});var a=s(9099),r=s(9291),n=s(6508);let i=()=>(0,n.Z)({url:"/cart/list",method:"post"}),l=e=>(0,n.Z)({url:"/cart/add",method:"post",data:e}),c=e=>(0,n.Z)({url:"/cart/update",method:"post",data:e}),d=e=>(0,n.Z)({url:"/cart/delete",method:"post",data:e}),o=e=>(0,n.Z)({url:"/cart/deleteone",method:"post",data:e}),u=(0,a.Ue)()((0,r.tJ)((e,t)=>({items:[],totalQuantity:0,totalPrice:0,price:0,discount:0,couponCode:null,addItem:s=>e(e=>{let a,r=e.items.filter(e=>null!==e);r.find(e=>e.product_id===s.product_id)?(a=r.map(e=>e.product_id===s.product_id?{...e,quantity:e.quantity+s.quantity}:e),setImmediate(async()=>{await t().updateCart(s)})):(a=[...r,s],setImmediate(async()=>{await t().createCart(s)}));let n=a.reduce((e,t)=>e+t.price*t.quantity,0);return{items:a,totalQuantity:a.reduce((e,t)=>e+t.quantity,0),price:a.reduce((e,t)=>e+t.old_price*t.quantity,0),totalPrice:n-t().discount}}),removeItem:s=>e(e=>{if(e.items.filter(e=>e.product_id===s).length>0){let a=e.items.filter(e=>e.product_id!==s),r=a.reduce((e,t)=>e+t.price*t.quantity,0);return{items:a,totalQuantity:a.reduce((e,t)=>e+t.quantity,0),price:a.reduce((e,t)=>e+t.old_price*t.quantity,0),totalPrice:r-t().discount}}return e}),clearCart:()=>{e({items:[],totalQuantity:0,totalPrice:0,discount:0,couponCode:null})},setQuantity:(s,a)=>e(e=>{let r=e.items.filter(e=>null!==e),n=r.map(e=>e.product_id===s?{...e,quantity:Math.max(0,a)}:e).filter(e=>e.quantity>0),i=n.reduce((e,t)=>e+t.price*t.quantity,0),l=r.find(e=>e.product_id===s);return l&&setImmediate(async()=>{await t().updateCart({...l,quantity:a})}),{items:n,totalQuantity:n.reduce((e,t)=>e+t.quantity,0),price:n.reduce((e,t)=>e+t.old_price*t.quantity,0),totalPrice:i-t().discount}}),setSkuValue:(s,a)=>e(e=>{let r=e.items.filter(e=>null!==e),n=r.map(e=>e.product_id===s?{...e,size:a}:e).filter(e=>e.quantity>0),i=r.find(e=>e.product_id===s);return i&&setImmediate(async()=>{await t().updateCart(i)}),{items:n}}),applyCoupon:(s,a)=>{e({couponCode:s,discount:a,totalPrice:t().items.reduce((e,t)=>e+t.price*t.quantity,0)-a})},removeCoupon:()=>{e({couponCode:null,discount:0,totalPrice:t().items.reduce((e,t)=>e+t.price*t.quantity,0)})},fetchCartItems:async()=>{let t=await i();console.error("fetchCartItems response  object",t);let s=t.data;if(null==s?void 0:s.length){let t=s.reduce((e,t)=>e+t.price*t.quantity,0),a=s.reduce((e,t)=>e+t.quantity,0),r=s.reduce((e,t)=>e+t.old_price*t.quantity,0);e({items:s,totalPrice:t,totalQuantity:a,price:r})}else e({items:[]})},updateCart:async e=>{console.error("updateCartItem",await c(e))},deleteCart:async e=>{console.error("deleteCartItem",await d(e))},deleteCartOne:async e=>{console.error("deleteCartItemOne",await o(e))},createCart:async e=>{console.error("createCartItem",await l(e))}}),{name:"cart-storage",storage:(0,r.FL)(()=>localStorage)}))},4069:function(e,t,s){"use strict";s.d(t,{t:function(){return n}});var a=s(9099),r=s(9291);let n=(0,a.Ue)()((0,r.tJ)(e=>({token:null,user:null,setUser:t=>e({user:t}),setAuth:(t,s)=>e({token:t,user:s}),clearAuth:()=>e({token:null,user:null})}),{name:"auth-storage",storage:(0,r.FL)(()=>localStorage),migrate:e=>!e.expiresAt||new Date(e.expiresAt)<new Date?{token:null,user:null}:e}))},6508:function(e,t,s){"use strict";var a=s(8472),r=s(7928),n=s(4069);let i=a.Z.create({baseURL:"https://api.dms.pub/api/web",timeout:5e3});i.interceptors.request.use(e=>{let{token:t,user:s}=n.t.getState();return t&&(e.headers=e.headers||{},e.headers["x-token"]=t),(null==s?void 0:s.userId)&&(e.headers=e.headers||{},e.headers["x-user-id"]=s.userId),e.headers=e.headers||{},e.headers["Content-Type"]="application/json",e},e=>(r.ZP.destroy,r.ZP.error({content:"请求错误，请稍后再试",duration:5}),Promise.reject(e))),i.interceptors.response.use(e=>{let{status:t,data:s}=e;if(200===t)return 0===s.code?s:Promise.reject(s)},e=>{let{response:t}=e,{clearAuth:s}=n.t.getState();return r.ZP.destroy(),JSON.stringify(e).includes("Network Error")?r.ZP.error({content:"网络超时",duration:5}):t&&401===t.status?(r.ZP.error({content:"未授权，请重新登录",duration:5}),s()):r.ZP.error({content:"请求错误，状态码：".concat(null==t?void 0:t.status),duration:5}),Promise.reject(e)}),t.Z=i}},function(e){e.O(0,[453,925,106,633,648,402,138,586,347,84,971,23,744],function(){return e(e.s=4010)}),_N_E=e.O()}]);