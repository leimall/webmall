"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[885],{1063:function(e,t,r){r.d(t,{Z:function(){return c}});var a=r(7437),i=r(2265),s=r(6648),n=r(9910),d=r(8347),l=r(7138);function c(e){let{item:t,index:r,length:c}=e,{setQuantity:o,removeItem:u,setSkuValue:m}=(0,n.x)(),[p,h]=(0,i.useState)(["L","M","S","XS"]),[x,f]=(0,i.useState)([]),[y,g]=(0,i.useState)(0),[j,v]=(0,i.useState)(!0);(0,i.useEffect)(()=>{w()},[]);let w=()=>{f(p.map(e=>({value:e,label:e}))),t.price_off>0&&g(100-t.price_off),r===c-1&&v(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"md:col-span-2 rounded-md",children:(0,a.jsx)("div",{className:"items-center gap-4",children:(0,a.jsxs)("div",{className:"md:col-span-2 flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-32 h-32 shrink-0 border rounded bg-white",children:(0,a.jsx)(s.default,{src:t.main_img,alt:t.title,objectFit:"fixed",width:96,height:96,className:"rounded h-full w-full "})}),(0,a.jsxs)("div",{className:"w-full ml-0 md:ml-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-md font-bold text-gray-800 truncate",children:(0,a.jsx)(l.default,{href:"/product/".concat(t.product_id),children:(0,a.jsx)("div",{className:"text-sm text-pretty font-extrabold text-fta-primary-800 h-10 line-clamp-2",children:t.title})})}),(0,a.jsx)("h6",{onClick:()=>u(t.product_id),className:"text-sm text-blue-500 cursor-pointer mt-0.5",children:"Remove"})]}),(0,a.jsx)("div",{className:"flex items-center justify-end",children:(0,a.jsxs)("div",{className:"flex justify-center items-end font-sans",children:[t.old_price*t.quantity>0&&(0,a.jsxs)("span",{className:"text-gray-500 line-through text-sm mr-2",children:["$",t.old_price*t.quantity]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("div",{className:"text-gray-800 text-md font-bold",children:["$",t.price*t.quantity]}),(0,a.jsx)("div",{className:"text-red-600 text-sm font-bold px-2",children:t.price_off>0?"(-".concat(100-t.price_off,"%)"):""})]})]})}),(0,a.jsxs)("div",{className:"flex gap-4 mt-1 md:mt-2",children:[(0,a.jsx)("div",{className:"relative group bg-white",children:(0,a.jsx)("div",{children:(0,a.jsx)(d.default,{defaultValue:t.size,style:{width:80},options:x,onChange:e=>{m(t.product_id,e)}})})}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"bg-white",children:(0,a.jsxs)("div",{className:"flex items-center border border-gray-300 text-gray-800 text-md outline-none bg-transparent rounded",children:[(0,a.jsx)("div",{onClick:()=>{t.quantity>1&&o(t.product_id,t.quantity-1)},className:"px-3 py-3 cursor-pointer bg-orange-50  rounded-l ",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-2.5 fill-current",viewBox:"0 0 124 124",children:(0,a.jsx)("path",{d:"M112 50H12C5.4 50 0 55.4 0 62s5.4 12 12 12h100c6.6 0 12-5.4 12-12s-5.4-12-12-12z","data-original":"#000000"})})}),(0,a.jsx)("span",{className:"mx-2.5 w-5 text-center",children:t.quantity}),(0,a.jsx)("div",{onClick:()=>{o(t.product_id,t.quantity+1)},className:"px-3 cursor-pointer py-3 bg-orange-50 rounded-r",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-2.5 fill-current",viewBox:"0 0 42 42",children:(0,a.jsx)("path",{d:"M37.059 16H26V4.941C26 2.224 23.718 0 21 0s-5 2.224-5 4.941V16H4.941C2.224 16 0 18.282 0 21s2.224 5 4.941 5H16v11.059C16 39.776 18.282 42 21 42s5-2.224 5-4.941V26h11.059C39.776 26 42 23.718 42 21s-2.224-5-4.941-5z","data-original":"#000000"})})})]})})})]})]})]})})}),j&&(0,a.jsx)("hr",{className:"border-gray-black my-6"})]})}},9910:function(e,t,r){r.d(t,{x:function(){return u}});var a=r(9099),i=r(9291),s=r(6508);let n=()=>(0,s.Z)({url:"/cart/list",method:"post"}),d=e=>(0,s.Z)({url:"/cart/add",method:"post",data:e}),l=e=>(0,s.Z)({url:"/cart/update",method:"post",data:e}),c=e=>(0,s.Z)({url:"/cart/delete",method:"post",data:e}),o=e=>(0,s.Z)({url:"/cart/deleteone",method:"post",data:e}),u=(0,a.Ue)()((0,i.tJ)((e,t)=>({items:[],totalQuantity:0,totalPrice:0,price:0,discount:0,couponCode:null,addItem:r=>e(e=>{let a,i=e.items.filter(e=>null!==e);i.find(e=>e.product_id===r.product_id)?(a=i.map(e=>e.product_id===r.product_id?{...e,quantity:e.quantity+r.quantity}:e),setImmediate(async()=>{await t().updateCart(r)})):(a=[...i,r],setImmediate(async()=>{await t().createCart(r)}));let s=a.reduce((e,t)=>e+t.price*t.quantity,0);return{items:a,totalQuantity:a.reduce((e,t)=>e+t.quantity,0),price:a.reduce((e,t)=>e+t.old_price*t.quantity,0),totalPrice:s-t().discount}}),removeItem:r=>e(e=>{if(e.items.filter(e=>e.product_id===r).length>0){let a=e.items.filter(e=>e.product_id!==r),i=a.reduce((e,t)=>e+t.price*t.quantity,0);return{items:a,totalQuantity:a.reduce((e,t)=>e+t.quantity,0),price:a.reduce((e,t)=>e+t.old_price*t.quantity,0),totalPrice:i-t().discount}}return e}),clearCart:()=>{e({items:[],totalQuantity:0,totalPrice:0,discount:0,couponCode:null})},clearCartItem:e=>{t().deleteCart(e),t().clearCart()},setQuantity:(r,a)=>e(e=>{let i=e.items.filter(e=>null!==e),s=i.map(e=>e.product_id===r?{...e,quantity:Math.max(0,a)}:e).filter(e=>e.quantity>0),n=s.reduce((e,t)=>e+t.price*t.quantity,0),d=i.find(e=>e.product_id===r);return d&&setImmediate(async()=>{await t().updateCart({...d,quantity:a})}),{items:s,totalQuantity:s.reduce((e,t)=>e+t.quantity,0),price:s.reduce((e,t)=>e+t.old_price*t.quantity,0),totalPrice:n-t().discount}}),setSkuValue:(r,a)=>e(e=>{let i=e.items.filter(e=>null!==e),s=i.map(e=>e.product_id===r?{...e,size:a}:e).filter(e=>e.quantity>0),n=i.find(e=>e.product_id===r);return n&&setImmediate(async()=>{await t().updateCart(n)}),{items:s}}),applyCoupon:(r,a)=>{e({couponCode:r,discount:a,totalPrice:t().items.reduce((e,t)=>e+t.price*t.quantity,0)-a})},removeCoupon:()=>{e({couponCode:null,discount:0,totalPrice:t().items.reduce((e,t)=>e+t.price*t.quantity,0)})},fetchCartItems:async()=>{let t=await n();console.error("fetchCartItems response  object",t);let r=t.data;if(null==r?void 0:r.length){let t=r.reduce((e,t)=>e+t.price*t.quantity,0),a=r.reduce((e,t)=>e+t.quantity,0),i=r.reduce((e,t)=>e+t.old_price*t.quantity,0);e({items:r,totalPrice:t,totalQuantity:a,price:i})}else e({items:[]})},updateCart:async e=>{console.error("updateCartItem",await l(e))},deleteCart:async e=>{console.error("deleteCartItem",await c(e))},deleteCartOne:async e=>{console.error("deleteCartItemOne",await o(e))},createCart:async e=>{console.error("createCartItem",await d(e))}}),{name:"cart-storage",storage:(0,i.FL)(()=>localStorage)}))},9262:function(e,t,r){r.d(t,{L:function(){return s}});var a=r(9099),i=r(9291);let s=(0,a.Ue)()((0,i.tJ)(e=>({order:null,addProduct:t=>e(e=>{if(!e.order)return{order:null};let r=[...e.order.products,t],a=r.reduce((e,t)=>e+t.price*t.quantity,0);return{order:{...e.order,products:r,totalPrice:a}}}),createOrder:t=>e(()=>({order:t})),removeProduct:t=>e(e=>{if(!e.order)return{order:null};let r=e.order.products.filter(e=>e.product_id!==t),a=r.reduce((e,t)=>e+t.price*t.quantity,0);return{order:{...e.order,products:r,totalPrice:a}}}),updateOrder:t=>e(e=>({order:e.order?{...e.order,...t}:null})),clearOrder:()=>e(()=>({order:null}))}),{name:"order-storage",storage:(0,i.FL)(()=>localStorage)}))},4069:function(e,t,r){r.d(t,{t:function(){return s}});var a=r(9099),i=r(9291);let s=(0,a.Ue)()((0,i.tJ)(e=>({token:null,user:null,setUser:t=>e({user:t}),setAuth:(t,r)=>e({token:t,user:r}),clearAuth:()=>e({token:null,user:null})}),{name:"auth-storage",storage:(0,i.FL)(()=>localStorage),migrate:e=>!e.expiresAt||new Date(e.expiresAt)<new Date?{token:null,user:null}:e}))},6508:function(e,t,r){var a=r(8472),i=r(7928),s=r(4069);let n=a.Z.create({baseURL:"https://api.dms.pub/api/web",timeout:5e3});n.interceptors.request.use(e=>{let{token:t,user:r}=s.t.getState();return t&&(e.headers=e.headers||{},e.headers["x-token"]=t),(null==r?void 0:r.userId)&&(e.headers=e.headers||{},e.headers["x-user-id"]=r.userId),e.headers=e.headers||{},e.headers["Content-Type"]="application/json",e},e=>(i.ZP.destroy,i.ZP.error({content:"请求错误，请稍后再试",duration:5}),Promise.reject(e))),n.interceptors.response.use(e=>{let{status:t,data:r}=e;if(200===t)return 0===r.code?r:Promise.reject(r)},e=>{let{response:t}=e,{clearAuth:r}=s.t.getState();return i.ZP.destroy(),JSON.stringify(e).includes("Network Error")?i.ZP.error({content:"网络超时",duration:5}):t&&401===t.status?(i.ZP.error({content:"未授权，请重新登录",duration:5}),r()):i.ZP.error({content:"请求错误，状态码：".concat(null==t?void 0:t.status),duration:5}),Promise.reject(e)}),t.Z=n}}]);